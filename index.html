<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rali Sains Tingkatan 2 (Solo)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Markdown styles for AI response */
        .ai-content strong { color: #34d399; font-weight: 700; }
        .ai-content em { color: #60a5fa; font-style: italic; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen">

    <!-- Main App Container -->
    <div id="app" class="max-w-md mx-auto min-h-screen p-4 flex flex-col">

        <!-- Lobby View (Enter Name) -->
        <div id="lobby-view" class="flex-1 flex flex-col justify-center space-y-6">
            <div class="text-center space-y-2">
                <h1 class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-emerald-400">
                    Rali Sains
                </h1>
                <p class="text-slate-400">Edisi Solo Tingkatan 2 (KSSM)</p>
            </div>

            <div class="bg-slate-800 p-6 rounded-2xl shadow-xl space-y-4 border border-slate-700">
                <div>
                    <label class="block text-sm font-medium text-slate-400 mb-1">Nama Anda</label>
                    <input type="text" id="player-name" placeholder="Contoh: Ali" class="w-full p-3 bg-slate-900 rounded-xl border border-slate-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition text-white">
                </div>
                <button id="btn-start-game" class="w-full py-4 bg-blue-600 hover:bg-blue-500 rounded-xl font-bold text-lg transition shadow-lg shadow-blue-900/30">
                    Mula Bermain
                </button>
            </div>
        </div>

        <!-- Game Quiz View -->
        <div id="game-view" class="hidden flex-1 flex flex-col pb-20">
            <!-- Progress Bar -->
            <div class="w-full bg-slate-800 h-3 rounded-full overflow-hidden mb-6">
                <div id="progress-bar" class="bg-blue-500 h-full w-0 transition-all duration-500"></div>
            </div>

            <div class="flex-1 flex flex-col justify-start">
                <!-- Question Card -->
                <div class="bg-slate-800 p-6 rounded-2xl shadow-xl border border-slate-700 mb-6 min-h-[150px] flex items-center justify-center text-center relative">
                     <!-- Next Button (Initially Hidden) -->
                    <button id="btn-next-q" class="hidden absolute -top-3 -right-3 bg-white text-slate-900 px-4 py-2 rounded-full font-bold shadow-lg hover:bg-blue-100 transition z-10 flex items-center">
                        Seterusnya â†’
                    </button>
                    <h2 id="question-text" class="text-xl md:text-2xl font-bold leading-relaxed">
                        Memuatkan Soalan...
                    </h2>
                </div>

                <!-- Options Grid -->
                <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <!-- Options injected here -->
                </div>

                <!-- AI Features Area (Initially Hidden) -->
                <div id="ai-features" class="hidden space-y-4">
                    <div class="flex space-x-2">
                        <button id="btn-ai-explain" class="flex-1 bg-indigo-600 hover:bg-indigo-500 text-white py-3 px-4 rounded-xl font-semibold transition flex items-center justify-center">
                            âœ¨ Jelaskan Jawapan
                        </button>
                        <button id="btn-ai-fact" class="flex-1 bg-fuchsia-600 hover:bg-fuchsia-500 text-white py-3 px-4 rounded-xl font-semibold transition flex items-center justify-center">
                            âœ¨ Fakta Menarik
                        </button>
                    </div>

                    <!-- AI Response Output Box -->
                    <div id="ai-output-box" class="hidden bg-slate-800/80 border border-indigo-500/30 p-4 rounded-xl animate-fade-in">
                        <div id="ai-loading" class="hidden flex items-center text-indigo-300">
                            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Sedang menjana...
                        </div>
                        <div id="ai-content" class="ai-content text-slate-200 leading-relaxed"></div>
                    </div>
                </div>
            </div>

             <!-- Current Player Stats -->
             <div class="mt-6 text-center text-slate-400 text-sm flex justify-between px-4 py-4 bg-slate-900/80 fixed bottom-0 left-0 right-0 max-w-md mx-auto backdrop-blur-sm border-t border-slate-800">
                 <span>Pemain: <b id="player-display" class="text-white"></b></span>
                 <span>Markah: <b id="personal-score" class="text-emerald-400">0</b></span>
             </div>
        </div>

        <!-- Finished View -->
        <div id="finished-view" class="hidden flex-1 flex flex-col items-center justify-center space-y-6 text-center">
            <div class="text-6xl">ðŸŽ‰</div>
            <h2 class="text-3xl font-bold">Tahniah!</h2>
            <p class="text-slate-400 text-lg">Anda telah menamatkan kuiz ini.</p>

            <div class="bg-slate-800 p-8 rounded-2xl border border-slate-700">
                <div class="text-slate-400 mb-2">Markah Akhir Anda</div>
                <div id="final-score" class="text-6xl font-extrabold text-emerald-400">0</div>
                <div id="final-grade" class="text-xl mt-4 font-bold text-white"></div>
            </div>

            <button onclick="location.reload()" class="px-8 py-3 bg-slate-700 hover:bg-slate-600 rounded-xl font-bold transition">
                Main Semula
            </button>
        </div>

    </div>

    <script type="module">
        // --- App State (Standalone - No Firebase) ---
        let playerName = "";
        let myScore = 0;
        let currentQuestionIndex = 0;
        let isSubmitting = false;

        // --- Soalan Sains Tingkatan 2 (KSSM) ---
        const QUESTIONS = [
             {
                q: "Biodiversiti: Manakah antara berikut adalah haiwan vertebrata?",
                options: ["Cacing tanah", "Ular", "Siput babi", "Labah-labah"],
                a: 1
            },
            {
                q: "Ekosistem: Apakah nama organisma yang membuat makanannya sendiri menggunakan cahaya matahari?",
                options: ["Pengguna", "Pengurai", "Pengeluar", "Pemangsa"],
                a: 2
            },
            {
                q: "Nutrisi: Kelas makanan manakah yang utama untuk pertumbuhan dan pembaikan tisu badan?",
                options: ["Karbohidrat", "Protein", "Lemak", "Vitamin"],
                a: 1
            },
            {
                q: "Kesihatan Manusia: Penyakit manakah yang disebabkan oleh virus?",
                options: ["Denggi", "Kolera", "Tibi (Batuk Kering)", "Kurap"],
                a: 0
            },
            {
                q: "Air & Larutan: Larutan yang tidak boleh melarutkan sebarang bahan terlarut lagi pada suhu tertentu ialah...",
                options: ["Larutan cair", "Larutan pekat", "Larutan tepu", "Ampaian"],
                a: 2
            },
            {
                q: "Asid & Alkali: Apakah perubahan warna kertas litmus biru apabila dicelup ke dalam jus limau berasid?",
                options: ["Kekal biru", "Bertukar merah", "Bertukar kuning", "Menjadi tidak berwarna"],
                a: 1
            },
            {
                q: "Daya & Gerakan: Unit S.I. bagi Daya ialah...",
                options: ["Kilogram (kg)", "Joule (J)", "Watt (W)", "Newton (N)"],
                a: 3
            },
            {
                q: "Sokongan & Gerakan: Haiwan manakah yang mempunyai rangka hidrostatik?",
                options: ["Ketam", "Cacing tanah", "Kucing", "Ikan"],
                a: 1
            },
            {
                q: "Tekanan: Mengapakah pendaki gunung kadang-kadang mengalami pendarahan hidung di altitud tinggi?",
                options: ["Tekanan atmosfera lebih tinggi", "Tekanan atmosfera lebih rendah", "Suhu terlalu rendah", "Kekurangan oksigen"],
                a: 1
            },
            {
                q: "Haba: Haba mengalir melalui rod logam pepejal secara...",
                options: ["Konduksi", "Perolakan", "Sinaran", "Penyejatan"],
                a: 0
            },
            {
                q: "Bunyi: Bunyi TIDAK BOLEH merambat melalui...",
                options: ["Air", "Udara", "Pepejal", "Vakum"],
                a: 3
            },
            {
                q: "Bintang & Galaksi: Matahari dikelaskan sebagai...",
                options: ["Planet", "Asteroid", "Bintang", "Meteor"],
                a: 2
            }
        ];

        // --- DOM Elements ---
        const views = {
            lobby: document.getElementById('lobby-view'),
            game: document.getElementById('game-view'),
            finished: document.getElementById('finished-view')
        };
        const aiFeatures = document.getElementById('ai-features');
        const aiOutputBox = document.getElementById('ai-output-box');
        const aiContent = document.getElementById('ai-content');
        const aiLoading = document.getElementById('ai-loading');
        const btnNextQ = document.getElementById('btn-next-q');

        // --- View Switching ---
        function switchView(viewName) {
            Object.values(views).forEach(el => el.classList.add('hidden'));
            views[viewName].classList.remove('hidden');
        }

        // --- Lobby Logic ---
        document.getElementById('btn-start-game').addEventListener('click', () => {
            const nameInput = document.getElementById('player-name').value.trim();
            if (!nameInput) {
                alert("Sila masukkan nama anda.");
                return;
            }
            playerName = nameInput;
            document.getElementById('player-display').textContent = playerName;
            switchView('game');
            loadQuestion();
        });

        // --- Game Logic ---
        function loadQuestion() {
            if (currentQuestionIndex >= QUESTIONS.length) {
                finishGame();
                return;
            }

            // Reset UI for new question
            aiFeatures.classList.add('hidden');
            aiOutputBox.classList.add('hidden');
            btnNextQ.classList.add('hidden');
            isSubmitting = false;

            const q = QUESTIONS[currentQuestionIndex];
            document.getElementById('question-text').textContent = q.q;

            const grid = document.getElementById('options-grid');
            grid.innerHTML = '';

            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = "w-full p-4 bg-slate-700 hover:bg-blue-600 text-left rounded-xl transition-all duration-200 font-medium border border-slate-600 hover:border-blue-400";
                btn.textContent = opt;
                btn.onclick = () => handleAnswer(idx, btn);
                grid.appendChild(btn);
            });

            const progress = ((currentQuestionIndex) / QUESTIONS.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
        }

        function handleAnswer(selectedIndex, btnElement) {
            if (isSubmitting) return;
            isSubmitting = true;

            const currentQ = QUESTIONS[currentQuestionIndex];
            const isCorrect = selectedIndex === currentQ.a;
            const points = isCorrect ? 10 : 0;

            // Disable all buttons
            const allBtns = document.getElementById('options-grid').children;
            for(let btn of allBtns) { btn.disabled = true; btn.classList.add('opacity-70'); }
            btnElement.classList.remove('opacity-70');

            if (isCorrect) {
                btnElement.classList.remove('bg-slate-700', 'hover:bg-blue-600');
                btnElement.classList.add('bg-emerald-500', 'border-emerald-400');
            } else {
                btnElement.classList.remove('bg-slate-700', 'hover:bg-blue-600');
                btnElement.classList.add('bg-red-500', 'border-red-400');
                 allBtns[currentQ.a].classList.add('bg-emerald-500/50', 'border-emerald-400/50');
                 allBtns[currentQ.a].classList.remove('opacity-70');
            }

            myScore += points;
            document.getElementById('personal-score').textContent = myScore;

            // REVEAL AI FEATURES & Next Button immediately after answering
            aiFeatures.classList.remove('hidden');
            btnNextQ.classList.remove('hidden');
        }

        // --- Next Question Handler ---
        btnNextQ.addEventListener('click', () => {
             currentQuestionIndex++;
             loadQuestion();
             window.scrollTo({top: 0, behavior: 'smooth'});
        });

        function finishGame() {
            document.getElementById('progress-bar').style.width = '100%';
            document.getElementById('final-score').textContent = `${myScore} / ${QUESTIONS.length * 10}`;
            
            let grade = "";
            const percentage = (myScore / (QUESTIONS.length * 10)) * 100;
            if (percentage >= 80) grade = "Cemerlang! ðŸŒŸ";
            else if (percentage >= 60) grade = "Bagus! ðŸ‘";
            else if (percentage >= 40) grade = "Boleh diperbaiki ðŸ’ª";
            else grade = "Cuba lagi! ðŸ”¥";
            
            document.getElementById('final-grade').textContent = grade;
            switchView('finished');
        }

        // --- GEMINI AI INTEGRATION ---
        async function callGemini(prompt) {
            aiOutputBox.classList.remove('hidden');
            aiLoading.classList.remove('hidden');
            aiContent.innerHTML = '';

            try {
                // NOTE: For standalone, the API key must be hardcoded if you want it to work outside this environment.
                // WARNING: Exposing API keys in client-side code on public GitHub is risky.
                // For school projects it might be okay temporarily, but be warned.
                const apiKey = ""; // ANDA PERLU MASUKKAN API KEY ANDA DI SINI UNTUK VERSI STANDALONE BERFUNGSI
                
                if (!apiKey) {
                     aiContent.textContent = "Ralat: API Key diperlukan untuk fungsi AI dalam versi standalone. Sila masukkan API key dalam kod.";
                     aiLoading.classList.add('hidden');
                     return;
                }

                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    }
                );

                const data = await response.json();
                if (data.candidates && data.candidates.length > 0) {
                    let text = data.candidates[0].content.parts[0].text;
                    text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
                    aiContent.innerHTML = text;
                } else {
                    aiContent.textContent = "Maaf, AI tidak dapat menjana respons pada masa ini.";
                }
            } catch (error) {
                console.error("AI Error:", error);
                aiContent.textContent = "Ralat sambungan AI. Sila periksa sambungan internet anda.";
            } finally {
                aiLoading.classList.add('hidden');
            }
        }

        document.getElementById('btn-ai-explain').addEventListener('click', () => {
            const q = QUESTIONS[currentQuestionIndex];
            const prompt = `Anda adalah guru sains Tingkatan 2. Terangkan ringkas (maks 3 ayat) kenapa jawapan ini betul dalam Bahasa Melayu mudah. Soalan: "${q.q}" Jawapan Betul: "${q.options[q.a]}"`;
            callGemini(prompt);
        });

        document.getElementById('btn-ai-fact').addEventListener('click', () => {
            const q = QUESTIONS[currentQuestionIndex];
            const prompt = `Berikan satu fakta sains menarik, ringkas dan mengejutkan berkaitan topik ini untuk pelajar Tingkatan 2 dalam Bahasa Melayu. Mula dengan "Tahukah anda?". Soalan: "${q.q}"`;
            callGemini(prompt);
        });

    </script>
</body>
</html>
